<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">

<dom-module id="degree-gauge">
    <template>
        <style include="shared-styles">
            .Circle-background {
                stroke: #f5f5f5;
            }
            .Circle-foreground {
                transition: stroke-dashoffset 150ms;
                stroke: #ff4081;
                stroke-linecap: butt;
            }
        </style>

        <svg id="circle">
            <circle class="Circle-background"
                    r$="[[_radius]]"
                    cx$="[[_cx]]"
                    cy$="[[_cy]]"
                    fill="transparent"
                    stroke-width$="[[strokeWidth]]" />
            <circle class="Circle-foreground"
                    r$="[[_radius]]"
                    cx$="[[_cx]]"
                    cy$="[[_cy]]"
                    fill="transparent"
                    stroke-width$="[[strokeWidth]]"
                    stroke-dasharray$="[[_dasharray]]"
                    stroke-dashoffset$="[[_dashoffset]]"
                    transform$="[[_transform]]" />
        </svg>
        <div>
            <input value="{{angle::input}}"/>
        </div>
    </template>

    <script>
        class DegreeGauge extends Polymer.Element {
            static get is() {
                return 'degree-gauge';
            }

            static get properties() {
                return {
                    strokeWidth: {
                        type: Number,
                        value: 12
                    },
                    angle: {
                        type: Number,
                        notify: true,
                        value: 90
                    },
                    _cx: {
                        type: Number,
                        value: 80
                    },
                    _cy: {
                        type: Number,
                        value: 80
                    },
                    _radius: {
                        type: Number,
                        computed: '_computeRadius(_cx, _cy, strokeWidth)'
                    },
                    _transform: {
                        type: String,
                        computed: '_computeTransform(angle, _cx, _cy)'
                    },
                    _dasharray: {
                        type: Number,
                        computed: '_computeDashArray(_radius)'
                    },
                    _dashoffset: {
                        type: Number,
                        computed: '_computeDashOffset(angle, _dasharray)'
                    }
                }
            }

            _computeDashArray(radius) {
                return 2 * Math.PI * radius;
            }

            _computeDashOffset(angle, dasharray) {
                const needleWidth = 5;
                return (1 - (needleWidth / 360)) * dasharray;
            }

            _computeRadius(cx, cy, strokeWidth) {
                return Math.max(0, Math.min(cx, cy) - strokeWidth / 2);
            }

            _computeTransform(angle, cx, cy) {
                return angle && cx && cy ? 'rotate(-' + angle + ', ' + cx + ', ' + cy + ')' : '';
            }
        }

        customElements.define(DegreeGauge.is, DegreeGauge);
    </script>
</dom-module>